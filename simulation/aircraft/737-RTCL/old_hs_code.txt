            <!--*************** MCAS \/ \/ *******************-->

            <!--switch name="fcs/stabilizer/mcas-active">
                <default value="fcs/stabilizer/mcas-active"/>
            </switch>

            <switch name="fcs/stabilizer/stab-target-unit">
                <default value="fcs/stabilizer/stab-target-unit"/>
                <test value="6.5">
                    simulation/sim-time-sec LE 0.1
                </test>
            </switch>

            <switch name="fcs/stabilizer/stabilizer-pos-unit">
                <default value="fcs/stabilizer/stabilizer-pos-unit"/>
                <test value="6.5">
                    simulation/sim-time-sec LE 0.1
                </test>
            </switch-->

            <!-- HS command pulses from MCAS activations -->
            <!--fcs_function name="fcs/stabilizer/mcas-min-next-activation-time">
            <function>
                <sum>
                    <property> fcs/stabilizer/mcas-timer-end-time </property>
                    <property> fcs/stabilizer/mcas-min-delay </property>	
                </sum>
            </function>
            </fcs_function>

            <switch name="fcs/stabilizer/no-recent-mcas-fire">
                <default value="0"/>
                <test value="1">
                    simulation/sim-time-sec GE fcs/stabilizer/mcas-min-next-activation-time
                </test>
            </switch>

            <fcs_function name="fcs/stabilizer/do-mcas-fire">
            <function>
                <product>
                    <property> fcs/stabilizer/no-recent-mcas-fire </property>
                    <property> fcs/stabilizer/mcas-active </property>
                </product>
            </function>
            </fcs_function-->

            <!-- timer-active=1 for some duration after mcas fires, then back to 0 -->
            <!--fcs_function name="fcs/stabilizer/now-plus-mcas-timer">
            <function>
                <sum>
                    <property> simulation/sim-time-sec </property>
                    <quotient>
                        <property> fcs/stabilizer/mcas-trim-amount </property>
                        <property> fcs/stabilizer/mcas-trim-rate </property>
                    </quotient>
                </sum>
            </function>
            </fcs_function>

            <switch name="fcs/stabilizer/mcas-timer-active">
                <default value="0"/>
                <test value="1">
                    simulation/sim-time-sec LE fcs/stabilizer/mcas-timer-end-time
                </test>
            </switch>

            <switch name="fcs/stabilizer/mcas-timer-end-time">
                <default value="fcs/stabilizer/mcas-timer-end-time"/>
                <test value="fcs/stabilizer/now-plus-mcas-timer">
                    fcs/stabilizer/do-mcas-fire == 1
                </test>
            </switch-->

            <!-- increment stab-target when mcas fires -->
            <!--fcs_function name="fcs/stabilizer/stab-target-plus-offset">
            <function>
                <sum>
                    <property> fcs/stabilizer/stab-target-unit </property>
                    <product>
                        <property> fcs/stabilizer/mcas-trim-amount </property>
                        <property> fcs/stabilizer/mcas-trim-direction </property>
                    </product>
                </sum>
            </function>
            </fcs_function>

            <switch name="fcs/stabilizer/stab-target-unit">
                <default value="fcs/stabilizer/stab-target-unit"/>
                <test value="fcs/stabilizer/stab-target-plus-offset">
                    fcs/stabilizer/do-mcas-fire == 1
                </test>
                <clipto>
                    <min> 0 </min>
                    <max> 17 </max>
                </clipto>
            </switch-->

            <!-- do-trim = 1 for duration after mcas fires -->
            <!--switch name="fcs/stabilizer/do-trim">
                <default value="0"/>
                <test logic="AND" value="1">
                    <test logic="OR">
                        fcs/stabilizer/mcas-timer-active == 1
                        fcs/stabilizer/pilot-trim-stab-target-diff NE 0
                    </test>
                    fcs/stabilizer/manual-active == 0
                </test>
            </switch-->

            <!-- trim rate decision -->
            <!--switch name="fcs/stabilizer/trim-rate">
                <default value="fcs/stabilizer/flaps-trim-rate"/>
                <test value="fcs/stabilizer/mcas-trim-rate">
                    fcs/stabilizer/mcas-timer-active == 1
                </test>
                <test value="fcs/stabilizer/no-flaps-trim-rate">
                    fcs/flap-pos-norm == 0
                </test>
            </switch-->

            <!--*************** MCAS /\ /\ *******************-->

            <!--*************** MANUAL TRIM \/ \/ *******************-->

            <!--switch name="fcs/stabilizer/manual-active">
                <default value="fcs/stabilizer/manual-active"/>
            </switch>

            <switch name="fcs/stabilizer/manual-trim-direction">
                <default value="fcs/stabilizer/manual-trim-direction"/>
            </switch>

            <fcs_function name="fcs/stabilizer/manual-trim-rate-total">
            <function>	
                <product>
                    <property> fcs/stabilizer/manual-trim-rate </property>		
                    <property> fcs/stabilizer/manual-active </property>
                </product>
            </function>
            </fcs_function>

            <fcs_function name="fcs/stabilizer/manual-trim-rate-per-tick-magnitude">
            <function>
            <product>
                <property> fcs/stabilizer/manual-trim-rate-total </property>
                <property> simulation/dt </property>
            </product>
            </function>
            </fcs_function>

            <fcs_function name="fcs/stabilizer/manual-stab-target-plus-offset">
            <function>
                <sum>
                    <property> fcs/stabilizer/stabilizer-pos-unit </property>
                    <product>
                        <property> fcs/stabilizer/manual-trim-rate-per-tick-magnitude </property>
                        <property> fcs/stabilizer/manual-trim-direction </property>
                    </product>
                </sum>
            </function>
            </fcs_function>

            <switch name="fcs/stabilizer/stab-target-unit">
                <default value="fcs/stabilizer/stab-target-unit"/>
                <test value="fcs/stabilizer/manual-stab-target-plus-offset">
                    fcs/stabilizer/manual-active == 1
                </test>
                <clipto>
                    <min> 0 </min>
                    <max> 17 </max>
                </clipto>
            </switch>

            <summer name="fcs/stabilizer/manual-errorfree-stab-error">
                <input>  fcs/stabilizer/stab-target-unit </input>
                <input> -fcs/stabilizer/stabilizer-pos-unit </input>
                <clipto>
                    <min> -fcs/stabilizer/manual-trim-rate-per-tick-magnitude </min>
                    <max>  fcs/stabilizer/manual-trim-rate-per-tick-magnitude </max>
                </clipto>
                <output> fcs/stabilizer/manual-stab-error </output>
            </summer-->

            <!--*************** MANUAL TRIM /\ /\ *******************-->

            <!--*************** PILOT TRIM \/ \/ *******************-->

            <!--switch name="fcs/stabilizer/pilot-trim-stab-target-diff">
                <default value="fcs/stabilizer/pilot-trim-stab-target-diff"/>
            </switch>

            <fcs_function name="fcs/stabilizer/pilot-stab-target-plus-offset">
            <function>
                <sum>
                    <property> fcs/stabilizer/stab-target-unit </property>
                    <property> fcs/stabilizer/pilot-trim-stab-target-diff </property>
                </sum>
            </function>
            </fcs_function>

            <switch name="fcs/stabilizer/stab-target-unit">
                <default value="fcs/stabilizer/stab-target-unit"/>
                <test value="fcs/stabilizer/pilot-stab-target-plus-offset">
                    fcs/stabilizer/pilot-trim-stab-target-diff NE 0
                </test>
                <clipto>
                    <min> 0 </min>
                    <max> 17 </max>
                </clipto>
            </switch-->

            <!--*************** PILOT TRIM /\ /\ *******************-->

            <!--fcs_function name="fcs/stabilizer/trim-rate-total">
            <function>	
                <product>
                    <property> fcs/stabilizer/trim-rate </property>		
                    <property> fcs/stabilizer/do-trim </property-->
                    <!--value> 1 </value-->
                <!--/product>
            </function>
            </fcs_function>

            <fcs_function name="fcs/stabilizer/trim-rate-per-tick-magnitude">
            <function>
            <product>
                <abs>
                    <property> fcs/stabilizer/trim-rate-total </property>
                </abs>
                <property> simulation/dt </property>
            </product>
            </function>
            </fcs_function>

                <summer name="fcs/stabilizer/errorfree-stab-error">
                    <input>  fcs/stabilizer/stab-target-unit </input>
                    <input> -fcs/stabilizer/stabilizer-pos-unit </input>
                    <clipto>
                    <min> -fcs/stabilizer/trim-rate-per-tick-magnitude </min>
                    <max>  fcs/stabilizer/trim-rate-per-tick-magnitude </max>
                    </clipto>
                    <output> fcs/stabilizer/stab-error </output>
                </summer>

                <summer name="fcs/stabilizer/stabilizer-pos-unit">
                    <input> fcs/stabilizer/stabilizer-pos-unit </input>
                    <input> fcs/stabilizer/manual-stab-error </input>
                    <input> fcs/stabilizer/stab-error </input>
                    <output> fcs/stabilizer/stabilizer-pos-unit </output>
                </summer>

                <fcs_function name="fcs/stab">
                    <function>
                    <product>
                        <sum>
                            <property> fcs/stabilizer/stabilizer-pos-unit </property>
                            <value> -4.2 </value>
                        </sum>
                        <value> -1 </value>
                    </product>
                    </function>
                </fcs_function-->